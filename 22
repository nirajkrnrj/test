// Create a variable to keep track of the current row index in the table
Int rowIndex = 0;
Output_0.Coverages.commit();

// Iterate through the policies array
for (Int i = 0; i < Input_0.policies.Count; i++) {
    var policy = Input_0.policies[i];

    for (Int j = 0; j < policy.coverages.Count; j++) {
        var coverage = policy.coverages[j];

        Output_0.Coverages.commit();

        for (Int k = 0; k < coverage.limits.Count; k++) {
            var limit = coverage.limits[k];
            if (not(limit.limitName.equalCaseInsensitive("Business Income") or limit.limitName.equalCaseInsensitive("Rental Value") or 
               limit.limitName.equalCaseInsensitive("Blanket Coverage") or limit.limitName.equalCaseInsensitive("Terrorism Coverage") or 
               limit.limitName.equalCaseInsensitive("Limited Fungus Coverage") or limit.limitName.equalCaseInsensitive("Replacement Cost") or 
               limit.limitName.equalCaseInsensitive("Agreed Value") or limit.limitName.equalCaseInsensitive("Coinsurance") or 
               limit.limitName.equalCaseInsensitive("Equipment Breakdown") or
               limit.limitName.equalCaseInsensitive("Ordinance or Law - Coverage for loss to Undamaged Portion of Building") or 
               limit.limitName.equalCaseInsensitive("Ordinance or Law - Demolition Cost") or 
               limit.limitName.equalCaseInsensitive("Ordinance or Law - Increase Cost of Construction") or 
               limit.limitName.equalCaseInsensitive("Earth Movement") or 
               limit.limitName.equalCaseInsensitive("Flood") or limit.limitName.equalCaseInsensitive("Wind / Hail Included") or 
               limit.limitName.equalCaseInsensitive("Named Storm Included") or
               limit.limitName.equalCaseInsensitive("Policy Limit"))) {
                for (Int m = 0; m < limit.subLimits.Count; m++) {
                    var subLimit = limit.subLimits[m];

                    // For each deductible, check if its limitMap contains this subLimit's limitId
                    for (Int n = 0; n < limit.deductibles.Count; n++) {
                        var deductible = limit.deductibles[n];

                        for (Int i = 0; i < deductible.limitMap.Count; i++) {
                            if (deductible.limitMap[i].Value == subLimit.limitId) {
                                // Deductible corresponds to this subLimit
                                Output_0.Coverages.Limits.LimitVals.Deductible.DeductibleValues = deductible.deductibleValue;
                                Output_0.Coverages.Limits.LimitVals.Deductible.DeductibleDescriptions = deductible.deductibleDescription;
                                Output_0.Coverages.Limits.LimitVals.Deductible.commit();
                            }
                        }
                    }

                    // Process subLimit as usual
                    if (limit.limitName != "Policy Limit") {
                        Output_0.Coverages.Limits.CoverageDescription_Or_LimitName = limit.limitName;
                    } else {
                        Output_0.Coverages.Limits.CoverageDescription_Or_LimitName = coverage.coverageDescription;
                    }
                    Output_0.Coverages.Limits.LimitVals.LimitValues = limit.subLimits[m].limitValue;
                    Output_0.Coverages.Limits.LimitVals.LimitDescriptions = limit.subLimits[m].limitDescription;
                    Output_0.Coverages.Limits.LimitVals.commit();
                }
                Output_0.Coverages.Limits.commit();
            }


        }
        Output_0.Coverages.commit();
    }
}